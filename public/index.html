<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Retune Web</title>
<p>retune by ear and exports to scala file</p>
<meta name="Microtonal scale generation tool" content=" .">
<meta name="Carlo Cattano" content=" .">

<link rel="stylesheet" href="styles/basic.css">
<script src="./scripts/NexusUI.js"></script>
<script	src="./scripts/Tone.js"></script>

<script src="./scripts/pitchManager.js"></script>

<body>
  <div id="wrapper">
    <div id="first" class="main">
    </div>
    <div id="second"></div>
    <div id="f1">
      <button type="button">Audio Test</button>  
    </div>
  </div>  
  <div id="piano"></div>
<script>
 
  var container = document.getElementById('first');	
  var sliders = []; //Array of Sliders to create d

  var rewer = new Tone.JCReverb(0.3).toMaster();
  var synth = new Tone.PolySynth(6, Tone.Synth).connect(rewer);
  
  rewer.wet.value = 0.4;
  Tone.context.latencyHint = 'interactive';
  synth.volume.value = -10;

  //Number box UI for pitch 
  var number = new Nexus.Number('#f1',{
    'size': [60,30],
    'value': 0,
    'min': 0,
    'max': 20000,
    'step': 0.001
  });

//  Init Tone js and dummy sound test  
  document.querySelector('button').addEventListener('click', () => testCheck());

//  AUDIO CONTEXT START 
  function testCheck(){
    Tone.start();
    Tone.resume;
    synth.frequency = 100;
    synth.triggerAttackRelease('C2', '8n');
  }
  
  ///	PIANO UI
  var piano = new Nexus.Piano('#piano',{
    'size': [350,170],
    'mode': 'button',  // 'button', 'toggle', or 'impulse'
    'lowNote': 24,
    'highNote': 36
  });
  ///////////////////////////////////////////////////////
  //Tone.Volume.value = -4;
  /// DIV creation
  /// SLIDERS
  //freeverb.dampening.value = 200;
  htmlString = '';

  for(var i=0; i<12; i++){ 
    //style="float:left;margin: 2px 2px 3px 2px;" 
    htmlString += '<div class="mySlider" style="float:left;margin: 2px 2px 6px 3px;"  id="'+ 
    "slider"+i +'"></div>';
  }
  container.insertAdjacentHTML('beforeend', htmlString);
  //////////////////////////////////////////////////////

  for (var i = 0; i < 12; i++) { //  Create Sliders
    var sName = "#slider" + i;
    sliders.push(new Nexus.Slider(sName));
  }

  for(var i = 0;i<12;i++){
    sliders[i].mode = 'absolute';
    sliders[i].value = 0.5;
    sliders[i].resize(23,100);
  } 

  sliders.forEach(function(element) {
    element.on('change',function(v){
      //console.log(v.toFixed(2)+" Slider");
    });
  });


  /// LINK NUMBERBOX TO DIAL UI 
  number.link(sliders[1]);

  //   PLAY THE CREATED TUNNING 
  piano.on('change',function(v) {
    /// v.note v.state
    //synth.frequency = notesList[v.note];

    if(v.state == true){
      synth.triggerAttack(notesList[v.note],"+0.05");
    }else{
      synth.triggerRelease(notesList[v.note],"+0.05");
    }
  });  

  function ResetOffsets(){
    for(let i = 0;i<12;i++){
      sliders[i].value = 0.5;
    }
  }
                  
</script>
</body>
</html>