<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Retune Web</title>
<p>retune by ear and exports to scala file</p>
<meta name="A tool for creating custom Temperaments" content="UI tool">
<meta name="CarloCattano" content="tools">
<link rel="stylesheet" href="./styles/basic.css">
<script src="./scripts/Tone.js"></script>
<script src="./scripts/NexusUI.js"></script>
<script src="./scripts/notesList.js"></script>
</head>
<body>
<div id="wrapper">
    <div id="first">
    </div>
    <div id="second"></div>
    <div id="f1">
        <button type="button">Click!</button>  
    </div>
 
</div>  
  <div id="piano"></div>
<script>
 const synth = new Tone.Synth().toMaster(); 
  
 var piano = new Nexus.Piano('#piano',{
    'size': [300,100],
    'mode': 'button',  // 'button', 'toggle', or 'impulse'
    'lowNote': 24,
    'highNote': 40
});
  
  var sliders = []; //Array of Sliders to create d
  
  /// DIV creation  d 
  
  var container = document.getElementById('first');
  htmlString = '';
  
  for(var i=0; i<12; i++){ 
    //Added class for further tweaking
    htmlString += '<div class="mySlider" style="float:left" id="'+ "slider"+i +'"></div>';
  }
  container.insertAdjacentHTML('beforeend', htmlString);
  //////////////////////////////////////////////////////
  
  for (var i = 0; i < 12; i++) { //  Cng 12 objectsdd
    var sName = "#slider" + i;
    sliders.push(new Nexus.Slider(sName));
  }

  for(var i = 0;i<12;i++){
    sliders[i].mode = 'absolute';
    sliders[i].value = 0.5;
    sliders[i].resize(20,100);
    sliders[i].on('change',function(v){
      console.log(v.toFixed(2));
    });
  }
//rezise test
//sliders[1].resize(40,200);
  //Number box UI for pitch 
  var number = new Nexus.Number('#f1',{
    'size': [60,30],
    'value': 0,
    'min': 0,
    'max': 20000,
    'step': 0.001
  });
  /// LINK NUMBERBOX TO DIAL UI 
  number.link(sliders[1]);

  //  Init Tone js and dummy sound test  
document.querySelector('button').addEventListener('click', () => testCheck());

  //  AUDIO CONTEXT START 
function testCheck(){
  Tone.start();
  Tone.resume;
  synth.frequency = 100;
  synth.triggerAttackRelease('C2', '8n');
}
  
 //   PLAY THE CREATED TUNNING 
  piano.on('change',function(v) {
    /// v.note v.state
    synth.frequency = notesList[v.note];
    if(v.state == true){
      synth.triggerAttack(notesList[v.note]);
    }else{
      synth.triggerRelease();
    }
});  

function ResetOffsets(){
  for(let i = 0;i<12;i++){
    sliders[i].value = 0.5;
  }
}
</script>
</body>
</html>
